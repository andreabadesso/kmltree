var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(m){var h="",i,f,b,c,j,n,o=0;for(m=Base64._utf8_encode(m);o<m.length;){i=m.charCodeAt(o++);f=m.charCodeAt(o++);b=m.charCodeAt(o++);c=i>>2;i=(i&3)<<4|f>>4;j=(f&15)<<2|b>>6;n=b&63;if(isNaN(f))j=n=64;else if(isNaN(b))n=64;h=h+this._keyStr.charAt(c)+this._keyStr.charAt(i)+this._keyStr.charAt(j)+this._keyStr.charAt(n)}return h},decode:function(m){var h="",i,f,b,c,j,n=0;for(m=m.replace(/[^A-Za-z0-9\+\/\=]/g,
"");n<m.length;){i=this._keyStr.indexOf(m.charAt(n++));f=this._keyStr.indexOf(m.charAt(n++));c=this._keyStr.indexOf(m.charAt(n++));j=this._keyStr.indexOf(m.charAt(n++));i=i<<2|f>>4;f=(f&15)<<4|c>>2;b=(c&3)<<6|j;h+=String.fromCharCode(i);if(c!=64)h+=String.fromCharCode(f);if(j!=64)h+=String.fromCharCode(b)}return h=Base64._utf8_decode(h)},_utf8_encode:function(m){m=m.replace(/\r\n/g,"\n");for(var h="",i=0;i<m.length;i++){var f=m.charCodeAt(i);if(f<128)h+=String.fromCharCode(f);else{if(f>127&&f<2048)h+=
String.fromCharCode(f>>6|192);else{h+=String.fromCharCode(f>>12|224);h+=String.fromCharCode(f>>6&63|128)}h+=String.fromCharCode(f&63|128)}}return h},_utf8_decode:function(m){for(var h="",i=0,f=c1=c2=0;i<m.length;){f=m.charCodeAt(i);if(f<128){h+=String.fromCharCode(f);i++}else if(f>191&&f<224){c2=m.charCodeAt(i+1);h+=String.fromCharCode((f&31)<<6|c2&63);i+=2}else{c2=m.charCodeAt(i+1);c3=m.charCodeAt(i+2);h+=String.fromCharCode((f&15)<<12|(c2&63)<<6|c3&63);i+=3}}return h}};
(function(){var m={};this.tmpl=function h(i,f){var b=!/\W/.test(i)?m[i]=m[i]||h(document.getElementById(i).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+i.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return f?b(f):b}})();
kmldom=function(){return function(m){if(window.ActiveXObject&&window.GetObject){var h=new ActiveXObject("Microsoft.XMLDOM");h.loadXML(m);return jQuery(h)}if(window.DOMParser)return jQuery((new DOMParser).parseFromString(m,"text/xml"));throw Error("No XML parser available");}}();var URI,URIQuery;
(function(){function m(f,b){var c=/^(.*)\//;return f.authority&&!f.path?"/"+b:f.getPath().match(c)[0]+b}function h(f){if(!f)return"";f=f.replace(/\/\.\//g,"/");for(f=f.replace(/\/\.$/,"/");f.match(i);)f=f.replace(i,"/");for(f=f.replace(/\/([^\/]*)\/\.\.$/,"/");f.match(/\/\.\.\//);)f=f.replace(/\/\.\.\//,"/");return f}var i=/\/((?!\.\.\/)[^\/]*)\/\.\.\//;URI=function(f){f||(f="");f=f.match(/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/);var b=f[1]||null,c=f[2]||null,j=
f[3]||null,n=f[4]||null,o=f[5]||null;this.getScheme=function(){return b};this.setScheme=function(l){b=l};this.getAuthority=function(){return c};this.setAuthority=function(l){c=l};this.getPath=function(){return j};this.setPath=function(l){j=l};this.getQuery=function(){return n};this.setQuery=function(l){n=l};this.getFragment=function(){return o};this.setFragment=function(l){o=l}};URI.prototype.toString=function(){var f="";if(this.getScheme())f+=this.getScheme()+":";if(this.getAuthority())f+="//"+this.getAuthority();
if(this.getPath())f+=this.getPath();if(this.getQuery())f+="?"+this.getQuery();if(this.getFragment())f+="#"+this.getFragment();return f};URI.prototype.resolve=function(f){var b=new URI;if(this.getScheme()){b.setScheme(this.getScheme());b.setAuthority(this.getAuthority());b.setPath(h(this.getPath()));b.setQuery(this.getQuery())}else{if(this.getAuthority()){b.setAuthority(this.getAuthority());b.setPath(h(this.getPath()));b.setQuery(this.getQuery())}else{if(this.getPath()){if(this.getPath().charAt(0)===
"/")b.setPath(h(this.getPath()));else{b.setPath(m(f,this.getPath()));b.setPath(h(b.getPath()))}b.setQuery(this.getQuery())}else{b.setPath(f.getPath());this.getQuery()?b.setQuery(this.getQuery()):b.setQuery(f.getQuery())}b.setAuthority(f.getAuthority())}b.setScheme(f.getScheme())}b.setFragment(this.getFragment());return b};URI.prototype.parseQuery=function(){return URIQuery.fromString(this.getQuery(),this.querySeparator)};URIQuery=function(){this.params={};this.separator="&"};URIQuery.fromString=function(f,
b){var c=new URIQuery;if(b)c.separator=b;c.addStringParams(f);return c};URIQuery.prototype.addStringParams=function(f){f=f.split(this.separator);for(var b,c,j=0;j<f.length;j++){b=f[j].split("=",2);c=b[0].replace(/\+/g," ");b=b[1].replace(/\+/g," ");this.params.hasOwnProperty(c)||(this.params[c]=[]);this.params[c].push(b)}};URIQuery.prototype.getParam=function(f){if(this.params.hasOwnProperty(f))return this.params[f][0];return null};URIQuery.prototype.toString=function(){var f=[],b;b=this.params;var c=
[],j;for(j in b)b.hasOwnProperty(j)&&c.push(j);b=c.sort();for(c=0;c<b.length;c++)for(j=0;j<this.params[b[c]].length;j++)f.push(b[c].replace(/ /g,"+")+"="+this.params[b[c]][j].replace(/ /g,"+"));return f.join(this.separator)}})();
var kmltree=function(){function m(b){var c=document.createElement("a");c.href=b;return c.href}openBalloon=function(b,c,j,n){var o;if(j.displayEnhancedContent){var l=b.getBalloonHtmlUnsafe();o=b.getBalloonHtml();o=$.trim(o.replace(/\s*<\!--\s*Content-type: mhtml-die-die-die\s*--\>/,""));o=o!=$.trim(l)}if(j.displayEnhancedContent&&o){o=c.createHtmlDivBalloon("");var B=$(['<iframe id="kmltree-balloon-iframe" border="0" frameBorder="0" src="',j.iframeSandbox,'"></iframe>'].join("")),t=document.createElement("div");
$(t).append(B);B.load(function(){this.contentWindow.postMessage(JSON.stringify({html:Base64.encode(l),callback:Base64.encode(j.sandboxedBalloonCallback.toString())}),"*")});o.setContentDiv(t)}else{o=c.createFeatureBalloon("");var s=function(F){setTimeout(function(){$(n).trigger("balloonopen",[F.getBalloon(),F.getFeature()])},1);google.earth.removeEventListener(c,"balloonopening",s)};google.earth.addEventListener(c,"balloonopening",s)}o.setFeature(b);c.setBalloon(o)};var h=function(b){if(b.success&&
b.error&&b.tree){this.queue=[];this.opts=b}else throw"missing required option";};h.prototype.add=function(b,c){this.queue.push({node:b,callback:c,loaded:false,errors:false})};h.prototype.execute=function(){if(this.queue.length===0)this.opts.success([]);else for(var b=0;b<this.queue.length;b++){var c=this.queue[b];c.node.data("queueItem",c);if(!c.loaded&&!c.loading){var j=this;$(c.node).bind("loaded",function(n,o,l){j.nodeLoadedCallback(n,o,l)});this.opts.tree.openNetworkLink(c.node);c.loading=true}}};
h.prototype.nodeLoadedCallback=function(b,c){var j=c.data("queueItem");if(j.loaded===true)throw"event listener fired twice for "+c.find(">span.name").text();j.loaded=true;j.loading=false;$(c).unbind("loaded");j.callback(c);this.execute();this.finish(j)};h.prototype.finish=function(){for(var b=true,c=true,j=0;j<this.queue.length;j++){b=b&&this.queue[j].loaded;c=c&&!this.queue[j].errors}if(b){c?this.opts.success(this.queue):this.opts.error(this.queue);this.destroy()}};h.prototype.destroy=function(){for(var b=
0;b<this.queue.length;b++)this.queue[b].node.unbind("load");this.queue=[]};var i=tmpl('<li UNSELECTABLE="on" id="<%= id %>" class="kmltree-item <%= listItemType %> <%= type %> <%= customClass %> <%= (visible ? "visible " : "") %><%= (customIcon ? "hasIcon " : "") %><%= (alwaysRenderNodes ? "alwaysRenderNodes " : "") %><%= (select ? "select " : "") %><%= (open ? "open " : "") %><%= (description ? "hasDescription " : "") %><%= (snippet ? "hasSnippet " : "") %><%= (customIcon ? "customIcon " : "") %><% if(kmlId){ %><%= kmlId %> <% } %><% if(geoType){ %><%= geoType %><% } %>"<% if(kmlId){ %> data-id="<%= kmlId %>"<% } %>><div UNSELECTABLE="on" class="expander">&nbsp;</div><div UNSELECTABLE="on" class="toggler">&nbsp;</div><div <% if(customIcon){ %>style="background:url(<%= customIcon %>); -moz-background-size:16px 16px; -webkit-background-size:16px 16px;"<% } %>class="icon"><% if(type === "KmlNetworkLink"){ %><div class="nlSpinner">&nbsp;</div><% } %>&nbsp;</div><span UNSELECTABLE="on" class="name"><%= name %></span><% if(snippet){ %><p UNSELECTABLE="on" class="snippet"><%= snippet %></p><% } %><% if(children.length) { %><ul><%= renderOptions(children) %></ul><% } %></li>'),
f={visitFunction:function(b,c){return c},refreshWithState:true,bustCache:false,restoreState:false,whitelist:[],supportItemIcon:false,loadingMsg:"Loading data",setExtent:false,displayDocumentRoot:"auto",displayEnhancedContent:false,iframeSandbox:"http://mm-01.msi.ucsb.edu/~cburt/kmltree/src/iframe.html",unknownIframeDimensionsDefault:{height:450,width:530},sandboxedBalloonCallback:function(){}};return function(b){var c={},j=0,n={};c.lookupTable=n;c.kmlObject=null;var o=[];b=jQuery.extend({},f,b);var l=
b.gex.pluginInstance,B=false,t={};parseFloat(l.getPluginVersion())<5.2&&alert("kmltree requires a google earth plugin version >= 5.2");if(!b.url||!b.gex||!b.element||!b.mapElement)throw"kmltree requires options url, gex, mapElement & element";b.element=$(b.element);if(!b.element.attr("id")){b.element.attr("id","kml-tree"+(new Date).getTime());b.element.attr("UNSELECTABLE","on")}b.restoreState&&$(window).unload(function(){c.destroy()});b.element.css("position")!=="absolute"&&$(b.element).css({position:"relative"});
var s=$('<div class="kmltree" style="background-size: 16px 16px; -moz-background-size: 16px 16px; -o-background-size: 16px 16px; -webkit-background-size: 16px 16px; -khtml-background-size: 16px 16px;"></div>'),F=s[0].style.backgroundSize!==undefined||s[0].style.MozBackgroundSize!==undefined||s[0].style.oBackgroundSize!==undefined||s[0].style.khtmlBackgroundSize!==undefined||s[0].style.webkitBackgroundSize!==undefined;b.displayEnhancedContent&&$(window).bind("message",function(a){a=a.originalEvent;
var d=a,e=b.unknownIframeDimensionsDefault;a=l.getBalloon();var g=$("#kmltree-balloon-iframe");window.w=d.source;if(!(g=!g.length))if(!(g=!(d.data.match(/width/)||d.data.match(/unknownIframeDimensions/))))if(!(g=a.getType()!=="GEHtmlDivBalloon")){g=$(a.getContentDiv()).find("iframe")[0];var k;b:for(var q=d.source,r=document.getElementsByTagName("iframe"),p=0;p<r.length;p++)if(r[0].contentWindow===q){k=r[p];break b}g=g!==k}if(!g){k=JSON.parse(d.data);if(k.unknownIframeDimensions)k=e;e=$("#kmltree-balloon-iframe");
a.setMinWidth(k.width);a.setMaxWidth(k.width+k.width*0.1);a.setMinHeight(k.height);a.setMaxHeight(k.height+k.height*0.1);e.height(k.height);e.width(k.width);$(c).trigger("balloonopen",[a,a.getFeature()])}});var S=function(a,d,e){var g={name:a.getName(),id:"kml"+(e?e.replace(/\W/g,"-"):"")+d.replace(/\W/g,"-")};google.earth.executeBatch(l,function(){b.gex.dom.walk({visitCallback:function(k){var q=k.current;if(!q.children)q.children=[];var r=this.getName(),p;p=q.id;key=r?r.replace(/\W/g,"-"):"blank";
p+=key;for(var u=0;n[p];){u++;p+=u}n[p]=this;var G=this.getSnippet();if(!G||G==="empty")G=false;u=this.getType();var R=false;if(u==="KmlPlacemark"){var H=this.getGeometry();if(H)R=H.getType()}var C=this.getComputedStyle();r=r||"&nbsp;";H=!!this.getVisibility();var ba=this.getOpen(),ca=this.getDescription(),w="check";if(C=C.getListStyle())switch(C.getListItemType()){case 5:w="radioFolder";break;case 2:w="checkOffOnly";break;case 3:w="checkHideChildren"}C=w;w=false;if(F&&this.getType()==="KmlPlacemark"&&
this.getGeometry()&&this.getGeometry().getType()==="KmlPoint")w=this.getComputedStyle().getIconStyle().getIcon().getHref();if(b.supportItemIcon)w=(w=kmldom(this.getKml()).find("kml>Folder, kml>Document, kml>Placemark, kml>NetworkLink").find(">Style>ListStyle>ItemIcon>href").text())?w:false;p={renderOptions:I,name:r,visible:H,type:u,open:ba,id:p,description:ca,snippet:G,select:false,listItemType:C,customIcon:w,customClass:"",children:[],alwaysRenderNodes:false,kmlId:this.getId().replace(/\W/g,"-"),
geoType:R};p=b.visitFunction(this,p);q.children.push(p);if(p.listItemType!=="checkHideChildren")k.child=p;else k.walkChildren=false},rootObject:a,rootContext:g})});return g},V=function(a){if(c.kmlObject)throw"KML already loaded";T();var d=m(b.url);if(a||b.bustCache){a=(new Date).getTime();d=d.indexOf("?")===-1?d+"?cachebuster="+a:d+"&cachebuster="+a}google.earth.fetchKml(l,d,function(e){B||U(e,d,b.url)})};c.load=V;c.refresh=function(){if(b.refreshWithState)c.previousState=L();W();n=null;n={};l.setBalloon(null);
V(true)};var M=function(a){return b.element.find("."+a.replace(/\W/g,"-"))};c.getNodesById=M;c.selectById=function(a){a=M(a)[0];return N(a,v(a))};var z=function(a,d){var e=$("#"+b.element.attr("id")).find(".selected").removeClass("selected");if(e.length){e.each(function(){x($(this),"selected",false)});d||$(c).trigger("select",[null,null])}l.getBalloon()&&!a&&l.setBalloon(null)};c.clearSelection=function(){return z()};var T=function(a){J();a=a||b.loadingMsg;a=$('<div class="kmltree-loading"><span>'+
a+"</span></div>");var d=b.element.height();d!==0&&a.height(d);b.element.append(a)};c.showLoading=T;var J=function(){b.element.find(".kmltree-loading").remove()};c.hideLoading=J;var U=function(a,d,e){t={};if(a){j=0;c.kmlObject=a;o.push(a);c.kmlObject.setVisibility(true);var g=S(a,e),k;if(b.displayDocumentRoot===false)k=g.children[0].children;else if(b.displayDocumentRoot===true)k=g.children[0];else{k=g.children[0].children;for(var q=0,r=false;q<k.length&&r===false;){r=k[q].type==="KmlPlacemark";q++}k=
r?g.children[0]:g.children[0].children}k=I(k);b.element.find("div.kmltree").remove();b.element.find(".kmltree-loading").before(['<div UNSELECTABLE="on" class="kmltree"><h4 UNSELECTABLE="on" class="kmltree-title">',g.children[0].name,'</h4><ul UNSELECTABLE="on" class="kmltree">',k,"</ul></div>"].join(""));l.getFeatures().appendChild(a);if(!c.previousState)if(b.restoreState&&window.localStorage)c.previousState=da();g=new h({success:function(){J();if(b.setExtent){var p=null,u=$(b.mapElement);if(u.length)p=
u.width()/u.height();b.gex.util.flyToObject(a,{boundsFallback:true,aspectRatio:p});b.setExtent=false}$(c).trigger("kmlLoaded",[a])},error:function(){J();$(c).trigger("kmlLoadError",[a])},tree:c});c.previousState?X(c.previousState,g):O(g,$("#"+b.element.attr("id")))}else if(j===0){j++;setTimeout(function(){jQuery.ajax({url:d,success:function(){c.load(true)},error:function(){U(a,d,e)}})},100)}else setTimeout(function(){b.element.html(['<div class="kmltree"><h4 class="kmltree-title">Error Loading</h4><p class="error">could not load kml file. Try clicking <a target="_blank" href="',
d,'">this link</a>, then refreshing the application.<p></div>'].join(""));$(c).trigger("kmlLoadError",[a])},0)},X=function(a,d){for(var e in a){var g=$("#"+e);if(g.length===1){for(var k in a[e]){g.toggleClass(k,a[e][k].value);x(g,k,a[e][k].value);k==="visible"&&v(g).setVisibility(a[e][k].value)}delete a[e]}}$("#"+b.element.attr("id")).find("li.KmlNetworkLink.open").each(function(){var q=$(this);!q.hasClass("checkHideChildren")&&!q.hasClass("loading")&&!q.hasClass("loaded")&&!q.hasClass("error")&&
d.add(q,function(){X(a,d)})});d.execute()},O=function(a,d){d.find("li.KmlNetworkLink.open").each(function(){var e=$(this);if(!e.hasClass("checkHideChildren")&&!e.hasClass("loading")&&!e.hasClass("loaded")){e.removeClass("open");a.add(e,function(g){g.addClass("open");x(g,"open",e.hasClass("open"));O(a,g)})}});a.execute()},I=function(a){if(jQuery.isArray(a)){for(var d=[],e=0;e<a.length;e++)d.push(i(jQuery.extend({},Y,a[e])));return d.join("")}else return i(jQuery.extend({},Y,a))},Y={renderOptions:I},
ea=function(){$(".KmlNetworkLink").each(function(){var a=v($(this));a&&a.getParentNode()&&b.gex.dom.removeObject(v($(this)))})},W=function(){ea();c.kmlObject&&c.kmlObject.getParentNode()&&b.gex.dom.removeObject(c.kmlObject);c.kmlObject=null;o=[]},da=function(){var a=localStorage.getItem("kmltree-("+b.url+")");return a?JSON.parse(a):false};c.destroy=function(){B=true;if(b.restoreState&&window.localStorage){var a=JSON.stringify(L());localStorage.setItem("kmltree-("+b.url+")",a)}W();n=null;n={};a=b.element.attr("id");
$("#"+a+" li > span.name").die();$("#"+a+" li").die();$("#"+a+" li > .expander").die();b.element.html("");google.earth.removeEventListener(l,"balloonopening",A);google.earth.removeEventListener(l,"balloonclose",Z);$("#kmltree-balloon-iframe").remove()};var v=function(a){a=$(a);return a.length?n[a.attr("id")]:false};c.lookup=v;var N=function(a,d){d||(d=v(a));a=$(a);z(true,true);a.addClass("selected");D(a,true);a.addClass("selected");google.earth.removeEventListener(l,"balloonopening",A);openBalloon(d,
l,b,c);google.earth.addEventListener(l,"balloonopening",A);for(var e=a.parent().parent();!e.hasClass("kmltree")&&!e.find(">ul:visible").length;){e.addClass("open");e=e.parent().parent()}x(a,"selected",true);$(c).trigger("select",[a,d])};c.selectNode=N;var E=function(a,d){if(d){if(!a.hasClass("checkOffOnly"))if(a.hasClass("radioFolder")){if(!a.find(">ul>li.visible").length){var e=a.find(">ul>li");if(e.length){y($(e[0]),true);E($(e[0]),true)}}}else a.find(">ul>li").each(function(){var g=$(this);if(!g.hasClass("checkOffOnly")){y(g,
true);E(g,true)}})}else a.find("li").each(function(){y($(this),false)})},P=function(a,d){var e=a.parent().parent();if(!e.hasClass("kmltree"))if(d){var g=e.parent().parent();g.hasClass("radioFolder")&&g.find(">ul>li.visible").each(function(){if(this!==e[0]){var k=$(this);y(k,false);E(k,false)}});if(!e.hasClass("visible")){y(e,true);P(e,true)}}else if(e.find(">ul>li.visible").length===0){y(e,false);P(e,false)}},D=function(a,d){if(!(a.hasClass("checkOffOnly")&&d)){var e=a.parent().parent();e.hasClass("radioFolder")&&
e.find(">ul>li.visible").each(function(){y($(this),false);E($(this),false)});y(a,d);d&&a.find("li.visible").length||E(a,d);P(a,d)}},y=function(a,d){a=$(a);if(a.hasClass("visible")!==d){x(a,"visible",d);v(a).setVisibility(d);a.toggleClass("visible",d)}},x=function(a,d,e){a=a.attr("id");t[a]||(t[a]={});a=t[a];if(a[d])a[d].value=e;else a[d]={original:!e,value:e}},L=function(){for(var a in t){for(var d in t[a])t[a][d].original===t[a][d].value&&delete t[a][d];var e=0;for(d in t[a])t[a].hasOwnProperty(d)&&
e++;e===0&&delete t[a]}return t};c.getState=L;c.openNetworkLink=function(a){if(a.find("> ul").length)throw"networklink already loaded";else{var d=v(a),e=d.getLink();if(e)var g=e=e.getHref();else{var k=kmldom(d.getKml()).find("Url>href");if(k.length)g=e=k.text();else{a.addClass("error");$(a).trigger("loaded",[a,false]);a.removeClass("open");x(a,"open",false);return}}k=new URI(e);if(k.getAuthority()===null){var q=d.getOwnerDocument();if(q&&q.getUrl)if(q=q.getUrl()){q=new URI(q);var r=k.resolve(q)}if(r)e=
r.toString();else alert(["Could not resolve relative link in kml ","document. You may need to upgrade to the ","latest Google Earth Plugin."].join())}if(b.bustCache){r=(new Date).getTime();e=e.indexOf("?")===-1?e+"?cachebuster="+r:e+"&cachebuster="+r}a.addClass("loading");google.earth.fetchKml(l,e,function(p){if(p){l.getFeatures().appendChild(p);p.setVisibility(d.getVisibility());var u=d.getName();d.getParentNode().getFeatures().removeChild(d);u=S(p,g,u);u=I(u.children[0].children);a.append("<ul>"+
u+"</ul>");a.addClass("open");x(a,"open",a.hasClass("open"));a.removeClass("loading");a.addClass("loaded");n[a.attr("id")]=p;o.push(p);$(a).attr("data-rememberedLink",K.length.toString());K.push(d);$(a).trigger("loaded",[a,p]);$(c).trigger("networklinkload",[a,p])}else{alert("Error loading "+e);a.addClass("error");$(c).trigger("kmlLoadError",[p]);a.removeClass("open")}})}};var K=[];c.getNetworkLink=function(a){return(a=$(a).attr("data-rememberedLink"))&&K.length>=a?K[a]:false};var aa=function(a){var d=
new h({success:function(){},error:function(){},tree:c});d.add(a,function(e){e.addClass("open");x(e,"open",a.hasClass("open"));O(d,e)});d.execute()};s=b.element.attr("id");$("#"+s+" li > span.name").live("click",function(a){a.stopPropagation();a=$(this).parent();var d=v(a);if(a.hasClass("error")&&a.hasClass("KmlNetworkLink"))d.getLink()&&d.getLink().getHref()?alert("Could not load NetworkLink with url "+d.getLink().getHref()):alert("Could not load NetworkLink. Link tag with href not found");if(a.hasClass("select"))N(a,
d);else{z();if(a.hasClass("hasDescription")||d.getType()==="KmlPlacemark"){d.getType()==="KmlPlacemark"&&D(a,true);google.earth.removeEventListener(l,"balloonopening",A);openBalloon(d,l,b,c);google.earth.addEventListener(l,"balloonopening",A)}}$(c).trigger("click",[a[0],d])});$("#"+s+" li > span.name").live("contextmenu",function(){var a=$(this).parent(),d=v(a);$(c).trigger("contextmenu",[a[0],d])});b.element.click(function(a){if(a.target===this)z();else{a=$(a.target);a.hasClass("toggle")&&!a.hasClass("select")&&
z()}});$("#"+s+" li > .expander").live("click",function(){var a=$(this).parent();if(a.hasClass("KmlNetworkLink")&&!a.hasClass("loaded")&&!a.hasClass("loading"))aa(a);else{a.toggleClass("open");x(a,"open",a.hasClass("open"))}});$("#"+s+" li > .toggler").live("click",function(){var a=$(this).parent(),d=!a.hasClass("visible");!d&&a.hasClass("selected")&&z();!d&&l.getBalloon()&&l.setBalloon(null);if(!(a.hasClass("checkOffOnly")&&d)){if(a.hasClass("KmlNetworkLink")&&a.hasClass("alwaysRenderNodes")&&!a.hasClass("open")&&
!a.hasClass("loading")&&!a.hasClass("loaded")){aa(a);$(a).bind("loaded",function(e,g){D(g,true);g.removeClass("open")})}else D(a,d);$(c).trigger("toggleItem",[a,d,v(a)])}});$("#"+s+" li").live("dblclick",function(a){a.stopPropagation();var d=$(a.target);a=d.parent();if(!(d.hasClass("expander")||d.hasClass("toggler")||a.hasClass("expander")||a.hasClass("toggler"))){d=$(this);var e=v(d);if(d.hasClass("error"))e.getLink()&&e.getLink().getHref()?alert("Could not load NetworkLink with url "+e.getLink().getHref()):
alert("Could not load NetworkLink. Link tag with href not found");else{D(d,true);if(e.getType()=="KmlTour")l.getTourPlayer().setTour(e);else{var g=null,k=$(b.mapElement);if(k.length)g=k.width()/k.height();b.gex.util.flyToObject(e,{boundsFallback:a.find("li").length<1E3,aspectRatio:g})}$(c).trigger("dblclick",[d,e])}}});s=google.earth.addEventListener;var A=function(a){var d=a.getFeature(),e;a:{e=d.getOwnerDocument();if(!e)for(var g=d;g.getType()!=="GEGlobe";){e=g;g=g.getParentNode()}for(g=0;g<o.length;g++)if(o[g].getUrl()===
e.getUrl()){e=true;break a}e=false}if(e){a.preventDefault();a.stopPropagation();l.setBalloon(null);openBalloon(d,l,b,c);return false}};google.earth.addEventListener(l,"balloonopening",A);var Z=function(){$("#kmltree-balloon-iframe").remove();z()};s(l,"balloonclose",Z);var Q=false;s(l.getGlobe(),"dblclick",function(a){if(a.getButton()!==-1){var d=a.getTarget();if(d.getType()!=="GEGlobe")if(d.getType()==="KmlPlacemark"){a=d.getId();var e=M(a);if(e.length>=1)if(!Q){Q=true;setTimeout(function(){Q=false;
var g=$(e[0]);$(c).trigger("dblclick",[g,d])},200)}}}});c.removeEventListener=c.detachEvent=function(){};return c}}(),enableGoogleLayersControl=function(){var m=function(h,i,f){if((h=h.getId())&&h.match(/^LAYER/))f.getLayerRoot().enableLayerById(f[h],i);else{var b=f.getOptions();switch(h){case "SUN":f.getSun().setVisibility(i);break;case "NAVIGATION_CONTROLS":h=f.VISIBILITY_SHOW;if(!i)h=f.VISIBILITY_HIDE;f.getNavigationControl().setVisibility(h);break;case "STATUS_BAR":b.setStatusBarVisibility(i);
break;case "OVERVIEW_MAP":b.setOverviewMapVisibility(i);break;case "SCALE_LEGEND":b.setScaleLegendVisibility(i);break;case "ATMOSPHERE":b.setAtmosphereVisibility(i);break;case "HISTORICAL_IMAGERY":f.getTime().setHistoricalImageryEnabled(i);break;case "GRID":b.setGridVisibility(i)}}};return function(h,i){if(!h||!i)alert("Must call enableGoogleLayersControl with both tree and ge options!");$(h).bind("toggleItem",function(f,b,c,j){m(j,c,i)});$(h).bind("kmlLoaded",function(f,b){for(var c=b.getFeatures().getChildNodes(),
j=c.getLength(),n=0;n<j;n++){var o=c.item(n);m(o,o.getVisibility(),i)}})}}();
