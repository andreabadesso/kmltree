var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(l){var i="",h,e,g,b,c,j,o=0;for(l=Base64._utf8_encode(l);o<l.length;){h=l.charCodeAt(o++);e=l.charCodeAt(o++);g=l.charCodeAt(o++);b=h>>2;h=(h&3)<<4|e>>4;c=(e&15)<<2|g>>6;j=g&63;if(isNaN(e))c=j=64;else if(isNaN(g))j=64;i=i+this._keyStr.charAt(b)+this._keyStr.charAt(h)+this._keyStr.charAt(c)+this._keyStr.charAt(j)}return i},decode:function(l){var i="",h,e,g,b,c,j=0;for(l=l.replace(/[^A-Za-z0-9\+\/\=]/g,
"");j<l.length;){h=this._keyStr.indexOf(l.charAt(j++));e=this._keyStr.indexOf(l.charAt(j++));b=this._keyStr.indexOf(l.charAt(j++));c=this._keyStr.indexOf(l.charAt(j++));h=h<<2|e>>4;e=(e&15)<<4|b>>2;g=(b&3)<<6|c;i+=String.fromCharCode(h);if(b!=64)i+=String.fromCharCode(e);if(c!=64)i+=String.fromCharCode(g)}return i=Base64._utf8_decode(i)},_utf8_encode:function(l){l=l.replace(/\r\n/g,"\n");for(var i="",h=0;h<l.length;h++){var e=l.charCodeAt(h);if(e<128)i+=String.fromCharCode(e);else{if(e>127&&e<2048)i+=
String.fromCharCode(e>>6|192);else{i+=String.fromCharCode(e>>12|224);i+=String.fromCharCode(e>>6&63|128)}i+=String.fromCharCode(e&63|128)}}return i},_utf8_decode:function(l){for(var i="",h=0,e=c1=c2=0;h<l.length;){e=l.charCodeAt(h);if(e<128){i+=String.fromCharCode(e);h++}else if(e>191&&e<224){c2=l.charCodeAt(h+1);i+=String.fromCharCode((e&31)<<6|c2&63);h+=2}else{c2=l.charCodeAt(h+1);c3=l.charCodeAt(h+2);i+=String.fromCharCode((e&15)<<12|(c2&63)<<6|c3&63);h+=3}}return i}};
(function(){var l={};this.tmpl=function i(h,e){var g=!/\W/.test(h)?l[h]=l[h]||i(document.getElementById(h).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+h.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return e?g(e):g}})();
kmldom=function(){return function(l){if(window.ActiveXObject&&window.GetObject){var i=new ActiveXObject("Microsoft.XMLDOM");i.loadXML(l);return jQuery(i)}if(window.DOMParser)return jQuery((new DOMParser).parseFromString(l,"text/xml"));throw Error("No XML parser available");}}();var URI,URIQuery;
(function(){function l(e,g){var b=/^(.*)\//;return e.authority&&!e.path?"/"+g:e.getPath().match(b)[0]+g}function i(e){if(!e)return"";e=e.replace(/\/\.\//g,"/");for(e=e.replace(/\/\.$/,"/");e.match(h);)e=e.replace(h,"/");for(e=e.replace(/\/([^\/]*)\/\.\.$/,"/");e.match(/\/\.\.\//);)e=e.replace(/\/\.\.\//,"/");return e}var h=/\/((?!\.\.\/)[^\/]*)\/\.\.\//;URI=function(e){e||(e="");e=e.match(/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/);var g=e[1]||null,b=e[2]||null,c=
e[3]||null,j=e[4]||null,o=e[5]||null;this.getScheme=function(){return g};this.setScheme=function(m){g=m};this.getAuthority=function(){return b};this.setAuthority=function(m){b=m};this.getPath=function(){return c};this.setPath=function(m){c=m};this.getQuery=function(){return j};this.setQuery=function(m){j=m};this.getFragment=function(){return o};this.setFragment=function(m){o=m}};URI.prototype.toString=function(){var e="";if(this.getScheme())e+=this.getScheme()+":";if(this.getAuthority())e+="//"+this.getAuthority();
if(this.getPath())e+=this.getPath();if(this.getQuery())e+="?"+this.getQuery();if(this.getFragment())e+="#"+this.getFragment();return e};URI.prototype.resolve=function(e){var g=new URI;if(this.getScheme()){g.setScheme(this.getScheme());g.setAuthority(this.getAuthority());g.setPath(i(this.getPath()));g.setQuery(this.getQuery())}else{if(this.getAuthority()){g.setAuthority(this.getAuthority());g.setPath(i(this.getPath()));g.setQuery(this.getQuery())}else{if(this.getPath()){if(this.getPath().charAt(0)===
"/")g.setPath(i(this.getPath()));else{g.setPath(l(e,this.getPath()));g.setPath(i(g.getPath()))}g.setQuery(this.getQuery())}else{g.setPath(e.getPath());this.getQuery()?g.setQuery(this.getQuery()):g.setQuery(e.getQuery())}g.setAuthority(e.getAuthority())}g.setScheme(e.getScheme())}g.setFragment(this.getFragment());return g};URI.prototype.parseQuery=function(){return URIQuery.fromString(this.getQuery(),this.querySeparator)};URIQuery=function(){this.params={};this.separator="&"};URIQuery.fromString=function(e,
g){var b=new URIQuery;if(g)b.separator=g;b.addStringParams(e);return b};URIQuery.prototype.addStringParams=function(e){e=e.split(this.separator);for(var g,b,c=0;c<e.length;c++){g=e[c].split("=",2);b=g[0].replace(/\+/g," ");g=g[1].replace(/\+/g," ");this.params.hasOwnProperty(b)||(this.params[b]=[]);this.params[b].push(g)}};URIQuery.prototype.getParam=function(e){if(this.params.hasOwnProperty(e))return this.params[e][0];return null};URIQuery.prototype.toString=function(){var e=[],g;g=this.params;var b=
[],c;for(c in g)g.hasOwnProperty(c)&&b.push(c);g=b.sort();for(b=0;b<g.length;b++)for(c=0;c<this.params[g[b]].length;c++)e.push(g[b].replace(/ /g,"+")+"="+this.params[g[b]][c].replace(/ /g,"+"));return e.join(this.separator)}})();
var kmltree=function(){function l(b){b=JSON.parse(b.data);console.log("resizing",b);var c=$("#kmltree-balloon-iframe");c.parent().parent().parent();c.height(b.height);c.width(b.width)}function i(b){var c=document.createElement("a");c.href=b;return c.href}openBalloon=function(b,c,j,o){if(j){var m=b.getBalloonHtmlUnsafe(),w=b.getBalloonHtml(),r=document.createElement("div");r.innerHTML=w;w=document.createElement("div");w.innerHTML=m;r=$.trim($(r).html().replace(/\s*<\!--\s*Content-type: mhtml-die-die-die\s*--\>/,
""));w=$.trim($(w).html().replace(/\s*<\!--\s*Content-type: mhtml-die-die-die\s*--\>/,""));r=r!=w}if(j&&r){var s=m;j=c.createHtmlDivBalloon("");j.setFeature(b);b=$(['<iframe id="kmltree-balloon-iframe" border="0" frameBorder="0" seamless="true" sandbox="allow-scripts" src="',o,'"></iframe>'].join(""));o=document.createElement("div");$(o).append(b);b.load(function(){this.contentWindow.postMessage(Base64.encode(s),"*");window.addEventListener("message",l,false)});j.setContentDiv(o);c.setBalloon(j)}else{o=
c.createFeatureBalloon("");o.setFeature(b);o.setMinWidth(100);c.setBalloon(o)}};var h=function(b){if(b.success&&b.error&&b.tree){this.queue=[];this.opts=b}else throw"missing required option";};h.prototype.add=function(b,c){this.queue.push({node:b,callback:c,loaded:false,errors:false})};h.prototype.execute=function(){if(this.queue.length===0)this.opts.success([]);else for(var b=0;b<this.queue.length;b++){var c=this.queue[b];c.node.data("queueItem",c);if(!c.loaded&&!c.loading){var j=this;$(c.node).bind("loaded",
function(o,m,w){j.nodeLoadedCallback(o,m,w)});this.opts.tree.openNetworkLink(c.node);c.loading=true}}};h.prototype.nodeLoadedCallback=function(b,c){var j=c.data("queueItem");if(j.loaded===true)throw"event listener fired twice for "+c.find(">span.name").text();j.loaded=true;j.loading=false;$(c).unbind("loaded");j.callback(c);this.execute();this.finish(j)};h.prototype.finish=function(){for(var b=true,c=true,j=0;j<this.queue.length;j++){b=b&&this.queue[j].loaded;c=c&&!this.queue[j].errors}if(b){c?this.opts.success(this.queue):
this.opts.error(this.queue);this.destroy()}};h.prototype.destroy=function(){for(var b=0;b<this.queue.length;b++)this.queue[b].node.unbind("load");this.queue=[]};var e=tmpl('<li UNSELECTABLE="on" id="<%= id %>" class="kmltree-item <%= listItemType %> <%= type %> <%= customClass %> <%= (visible ? "visible " : "") %><%= (customIcon ? "hasIcon " : "") %><%= (alwaysRenderNodes ? "alwaysRenderNodes " : "") %><%= (select ? "select " : "") %><%= (open ? "open " : "") %><%= (description ? "hasDescription " : "") %><%= (snippet ? "hasSnippet " : "") %><%= (customIcon ? "customIcon " : "") %><% if(kmlId){ %><%= kmlId %> <% } %><% if(geoType){ %><%= geoType %><% } %>"<% if(kmlId){ %> data-id="<%= kmlId %>"<% } %>><div UNSELECTABLE="on" class="expander">&nbsp;</div><div UNSELECTABLE="on" class="toggler">&nbsp;</div><div <% if(customIcon){ %>style="background:url(<%= customIcon %>); -moz-background-size:16px 16px; -webkit-background-size:16px 16px;"<% } %>class="icon"><% if(type === "KmlNetworkLink"){ %><div class="nlSpinner">&nbsp;</div><% } %>&nbsp;</div><span UNSELECTABLE="on" class="name"><%= name %></span><% if(snippet){ %><p UNSELECTABLE="on" class="snippet"><%= snippet %></p><% } %><% if(children.length) { %><ul><%= renderOptions(children) %></ul><% } %></li>'),
g={visitFunction:function(b,c){return c},refreshWithState:true,bustCache:false,restoreState:false,whitelist:[],supportItemIcon:false,loadingMsg:"Loading data",setExtent:false,displayDocumentRoot:"auto",displayUnsafeContent:false,iframeSandbox:"http://mm-01.msi.ucsb.edu/~cburt/kmltree/src/iframe.html?"};return function(b){var c={},j=0,o={};c.lookupTable=o;c.kmlObject=null;b=jQuery.extend({},g,b);var m=b.gex.pluginInstance,w=false,r={};parseFloat(m.getPluginVersion())<5.2&&alert("kmltree requires a google earth plugin version >= 5.2");
if(!b.url||!b.gex||!b.element||!b.mapElement)throw"kmltree requires options url, gex, mapElement & element";b.element=$(b.element);if(!b.element.attr("id")){b.element.attr("id","kml-tree"+(new Date).getTime());b.element.attr("UNSELECTABLE","on")}b.restoreState&&$(window).unload(function(){c.destroy()});b.element.css("position")!=="absolute"&&$(b.element).css({position:"relative"});var s=$('<div class="kmltree" style="background-size: 16px 16px; -moz-background-size: 16px 16px; -o-background-size: 16px 16px; -webkit-background-size: 16px 16px; -khtml-background-size: 16px 16px;"></div>'),
Y=s[0].style.backgroundSize!==undefined||s[0].style.MozBackgroundSize!==undefined||s[0].style.oBackgroundSize!==undefined||s[0].style.khtmlBackgroundSize!==undefined||s[0].style.webkitBackgroundSize!==undefined,Q=function(a,d,f){var k={name:a.getName(),id:"kml"+(f?f.replace(/\W/g,"-"):"")+d.replace(/\W/g,"-")};google.earth.executeBatch(m,function(){b.gex.dom.walk({visitCallback:function(n){var q=n.current;if(!q.children)q.children=[];var t=this.getName(),p;p=q.id;key=t?t.replace(/\W/g,"-"):"blank";
p+=key;for(var u=0;o[p];){u++;p+=u}o[p]=this;var E=this.getSnippet();if(!E||E==="empty")E=false;u=this.getType();var P=false;if(u==="KmlPlacemark"){var F=this.getGeometry();if(F)P=F.getType()}var B=this.getComputedStyle();t=t||"&nbsp;";F=!!this.getVisibility();var Z=this.getOpen(),aa=this.getDescription(),x="check";if(B=B.getListStyle())switch(B.getListItemType()){case 5:x="radioFolder";break;case 2:x="checkOffOnly";break;case 3:x="checkHideChildren"}B=x;x=false;if(Y&&this.getType()==="KmlPlacemark"&&
this.getGeometry()&&this.getGeometry().getType()==="KmlPoint")x=this.getComputedStyle().getIconStyle().getIcon().getHref();if(b.supportItemIcon)x=(x=kmldom(this.getKml()).find("kml>Folder, kml>Document, kml>Placemark, kml>NetworkLink").find(">Style>ListStyle>ItemIcon>href").text())?x:false;p={renderOptions:G,name:t,visible:F,type:u,open:Z,id:p,description:aa,snippet:E,select:false,listItemType:B,customIcon:x,customClass:"",children:[],alwaysRenderNodes:false,kmlId:this.getId().replace(/\W/g,"-"),
geoType:P};p=b.visitFunction(this,p);q.children.push(p);if(p.listItemType!=="checkHideChildren")n.child=p;else n.walkChildren=false},rootObject:a,rootContext:k})});return k},T=function(a){if(c.kmlObject)throw"KML already loaded";R();var d=i(b.url);if(a||b.bustCache){a=(new Date).getTime();d=d.indexOf("?")===-1?d+"?cachebuster="+a:d+"&cachebuster="+a}google.earth.fetchKml(m,d,function(f){w||S(f,d,b.url)})};c.load=T;c.refresh=function(){if(b.refreshWithState)c.previousState=J();U();o=null;o={};m.setBalloon(null);
T(true)};var K=function(a){return b.element.find("."+a.replace(/\W/g,"-"))};c.getNodesById=K;c.selectById=function(a){a=K(a)[0];return L(a,v(a))};var A=function(a,d){var f=$("#"+b.element.attr("id")).find(".selected").removeClass("selected");if(f.length){f.each(function(){y($(this),"selected",false)});d||$(c).trigger("select",[null,null])}m.getBalloon()&&!a&&m.setBalloon(null)};c.clearSelection=function(){return A()};var R=function(a){H();a=a||b.loadingMsg;a=$('<div class="kmltree-loading"><span>'+
a+"</span></div>");var d=b.element.height();d!==0&&a.height(d);b.element.append(a)};c.showLoading=R;var H=function(){b.element.find(".kmltree-loading").remove()};c.hideLoading=H;var S=function(a,d,f){r={};if(a){j=0;c.kmlObject=a;c.kmlObject.setVisibility(true);var k=Q(a,f),n;if(b.displayDocumentRoot===false)n=k.children[0].children;else if(b.displayDocumentRoot===true)n=k.children[0];else{n=k.children[0].children;for(var q=0,t=false;q<n.length&&t===false;){t=n[q].type==="KmlPlacemark";q++}n=t?k.children[0]:
k.children[0].children}n=G(n);b.element.find("div.kmltree").remove();b.element.find(".kmltree-loading").before(['<div UNSELECTABLE="on" class="kmltree"><h4 UNSELECTABLE="on" class="kmltree-title">',k.children[0].name,'</h4><ul UNSELECTABLE="on" class="kmltree">',n,"</ul></div>"].join(""));m.getFeatures().appendChild(a);if(!c.previousState)if(b.restoreState&&window.localStorage)c.previousState=ba();k=new h({success:function(){H();if(b.setExtent){var p=null,u=$(b.mapElement);if(u.length)p=u.width()/
u.height();b.gex.util.flyToObject(a,{boundsFallback:true,aspectRatio:p});b.setExtent=false}$(c).trigger("kmlLoaded",[a])},error:function(){H();$(c).trigger("kmlLoadError",[a])},tree:c});c.previousState?V(c.previousState,k):M(k,$("#"+b.element.attr("id")))}else if(j===0){j++;setTimeout(function(){jQuery.ajax({url:d,success:function(){c.load(true)},error:function(){S(a,d,f)}})},100)}else setTimeout(function(){b.element.html(['<div class="kmltree"><h4 class="kmltree-title">Error Loading</h4><p class="error">could not load kml file. Try clicking <a target="_blank" href="',
d,'">this link</a>, then refreshing the application.<p></div>'].join(""));$(c).trigger("kmlLoadError",[a])},0)},V=function(a,d){for(var f in a){var k=$("#"+f);if(k.length===1){for(var n in a[f]){k.toggleClass(n,a[f][n].value);y(k,n,a[f][n].value);n==="visible"&&v(k).setVisibility(a[f][n].value)}delete a[f]}}$("#"+b.element.attr("id")).find("li.KmlNetworkLink.open").each(function(){var q=$(this);!q.hasClass("checkHideChildren")&&!q.hasClass("loading")&&!q.hasClass("loaded")&&!q.hasClass("error")&&
d.add(q,function(){V(a,d)})});d.execute()},M=function(a,d){d.find("li.KmlNetworkLink.open").each(function(){var f=$(this);if(!f.hasClass("checkHideChildren")&&!f.hasClass("loading")&&!f.hasClass("loaded")){f.removeClass("open");a.add(f,function(k){k.addClass("open");y(k,"open",f.hasClass("open"));M(a,k)})}});a.execute()},G=function(a){if(jQuery.isArray(a)){for(var d=[],f=0;f<a.length;f++)d.push(e(jQuery.extend({},W,a[f])));return d.join("")}else return e(jQuery.extend({},W,a))},W={renderOptions:G},
ca=function(){$(".KmlNetworkLink").each(function(){var a=v($(this));a&&a.getParentNode()&&b.gex.dom.removeObject(v($(this)))})},U=function(){ca();c.kmlObject&&c.kmlObject.getParentNode()&&b.gex.dom.removeObject(c.kmlObject);c.kmlObject=null},ba=function(){var a=localStorage.getItem("kmltree-("+b.url+")");return a?JSON.parse(a):false};c.destroy=function(){w=true;if(b.restoreState&&window.localStorage){var a=JSON.stringify(J());localStorage.setItem("kmltree-("+b.url+")",a)}U();o=null;o={};a=b.element.attr("id");
$("#"+a+" li > span.name").die();$("#"+a+" li").die();$("#"+a+" li > .expander").die();b.element.html("")};var v=function(a){a=$(a);return a.length?o[a.attr("id")]:false};c.lookup=v;var L=function(a,d){d||(d=v(a));a=$(a);A(true,true);a.addClass("selected");C(a,true);a.addClass("selected");openBalloon(d,m,b.displayUnsafeContent,b.iframeSandbox);for(var f=a.parent().parent();!f.hasClass("kmltree")&&!f.find(">ul:visible").length;){f.addClass("open");f=f.parent().parent()}y(a,"selected",true);$(c).trigger("select",
[a,d])};c.selectNode=L;var D=function(a,d){if(d){if(!a.hasClass("checkOffOnly"))if(a.hasClass("radioFolder")){if(!a.find(">ul>li.visible").length){var f=a.find(">ul>li");if(f.length){z($(f[0]),true);D($(f[0]),true)}}}else a.find(">ul>li").each(function(){var k=$(this);if(!k.hasClass("checkOffOnly")){z(k,true);D(k,true)}})}else a.find("li").each(function(){z($(this),false)})},N=function(a,d){var f=a.parent().parent();if(!f.hasClass("kmltree"))if(d){var k=f.parent().parent();k.hasClass("radioFolder")&&
k.find(">ul>li.visible").each(function(){if(this!==f[0]){var n=$(this);z(n,false);D(n,false)}});if(!f.hasClass("visible")){z(f,true);N(f,true)}}else if(f.find(">ul>li.visible").length===0){z(f,false);N(f,false)}},C=function(a,d){if(!(a.hasClass("checkOffOnly")&&d)){var f=a.parent().parent();f.hasClass("radioFolder")&&f.find(">ul>li.visible").each(function(){z($(this),false);D($(this),false)});z(a,d);d&&a.find("li.visible").length||D(a,d);N(a,d)}},z=function(a,d){a=$(a);if(a.hasClass("visible")!==
d){y(a,"visible",d);v(a).setVisibility(d);a.toggleClass("visible",d)}},y=function(a,d,f){a=a.attr("id");r[a]||(r[a]={});a=r[a];if(a[d])a[d].value=f;else a[d]={original:!f,value:f}},J=function(){for(var a in r){for(var d in r[a])r[a][d].original===r[a][d].value&&delete r[a][d];var f=0;for(d in r[a])r[a].hasOwnProperty(d)&&f++;f===0&&delete r[a]}return r};c.getState=J;c.openNetworkLink=function(a){if(a.find("> ul").length)throw"networklink already loaded";else{var d=v(a),f=d.getLink();if(f)var k=f=
f.getHref();else{var n=kmldom(d.getKml()).find("Url>href");if(n.length)k=f=n.text();else{a.addClass("error");$(a).trigger("loaded",[a,false]);a.removeClass("open");y(a,"open",false);return}}n=new URI(f);if(n.getAuthority()===null){var q=d.getOwnerDocument();if(q&&q.getUrl)if(q=q.getUrl()){q=new URI(q);var t=n.resolve(q)}if(t)f=t.toString();else alert(["Could not resolve relative link in kml ","document. You may need to upgrade to the ","latest Google Earth Plugin."].join())}if(b.bustCache){t=(new Date).getTime();
f=f.indexOf("?")===-1?f+"?cachebuster="+t:f+"&cachebuster="+t}a.addClass("loading");google.earth.fetchKml(m,f,function(p){if(p){m.getFeatures().appendChild(p);p.setVisibility(d.getVisibility());var u=d.getName();d.getParentNode().getFeatures().removeChild(d);u=Q(p,k,u);u=G(u.children[0].children);a.append("<ul>"+u+"</ul>");a.addClass("open");y(a,"open",a.hasClass("open"));a.removeClass("loading");a.addClass("loaded");o[a.attr("id")]=p;$(a).attr("data-rememberedLink",I.length.toString());I.push(d);
$(a).trigger("loaded",[a,p]);$(c).trigger("networklinkload",[a,p])}else{alert("Error loading "+f);a.addClass("error");$(c).trigger("kmlLoadError",[p]);a.removeClass("open")}})}};var I=[];c.getNetworkLink=function(a){return(a=$(a).attr("data-rememberedLink"))&&I.length>=a?I[a]:false};var X=function(a){var d=new h({success:function(){},error:function(){},tree:c});d.add(a,function(f){f.addClass("open");y(f,"open",a.hasClass("open"));M(d,f)});d.execute()};s=b.element.attr("id");$("#"+s+" li > span.name").live("click",
function(){var a=$(this).parent(),d=v(a);if(a.hasClass("error")&&a.hasClass("KmlNetworkLink"))d.getLink()&&d.getLink().getHref()?alert("Could not load NetworkLink with url "+d.getLink().getHref()):alert("Could not load NetworkLink. Link tag with href not found");if(a.hasClass("select"))L(a,d);else{A();if(a.hasClass("hasDescription")||d.getType()==="KmlPlacemark"){d.getType()==="KmlPlacemark"&&C(a,true);openBalloon(d,m,b.displayUnsafeContent,b.iframeSandbox)}}$(c).trigger("click",[a[0],d])});$("#"+
s+" li > span.name").live("contextmenu",function(){var a=$(this).parent(),d=v(a);$(c).trigger("contextmenu",[a[0],d])});b.element.click(function(a){if(a.target===this)A();else{a=$(a.target);a.hasClass("toggle")&&!a.hasClass("select")&&A()}});$("#"+s+" li > .expander").live("click",function(){var a=$(this).parent();if(a.hasClass("KmlNetworkLink")&&!a.hasClass("loaded")&&!a.hasClass("loading"))X(a);else{a.toggleClass("open");y(a,"open",a.hasClass("open"))}});$("#"+s+" li > .toggler").live("click",function(){var a=
$(this).parent(),d=!a.hasClass("visible");!d&&a.hasClass("selected")&&A();!d&&m.getBalloon()&&m.setBalloon(null);if(!(a.hasClass("checkOffOnly")&&d)){if(a.hasClass("KmlNetworkLink")&&a.hasClass("alwaysRenderNodes")&&!a.hasClass("open")&&!a.hasClass("loading")&&!a.hasClass("loaded")){X(a);$(a).bind("loaded",function(f,k){C(k,true);k.removeClass("open")})}else C(a,d);$(c).trigger("toggleItem",[a,d,v(a)])}});$("#"+s+" li").live("dblclick",function(a){var d=$(a.target);a=d.parent();if(!(d.hasClass("expander")||
d.hasClass("toggler")||a.hasClass("expander")||a.hasClass("toggler"))){d=$(this);var f=v(d);if(d.hasClass("error"))f.getLink()&&f.getLink().getHref()?alert("Could not load NetworkLink with url "+f.getLink().getHref()):alert("Could not load NetworkLink. Link tag with href not found");else{C(d,true);if(f.getType()=="KmlTour")m.getTourPlayer().setTour(f);else{var k=null,n=$(b.mapElement);if(n.length)k=n.width()/n.height();b.gex.util.flyToObject(f,{boundsFallback:a.find("li").length<1E3,aspectRatio:k})}$(c).trigger("dblclick",
[d,f])}}});s=google.earth.addEventListener;google.earth.addEventListener(m,"balloonopening",function(a){m.setBalloon(null);a.preventDefault();openBalloon(a.getFeature(),m,b.displayUnsafeContent,b.iframeSandbox);return false});var O=false;s(m.getGlobe(),"dblclick",function(a){if(a.getButton()!==-1){var d=a.getTarget();if(d.getType()!=="GEGlobe")if(d.getType()==="KmlPlacemark"){a=d.getId();var f=K(a);if(f.length>=1)if(!O){O=true;setTimeout(function(){O=false;var k=$(f[0]);$(c).trigger("dblclick",[k,
d])},200)}}}});c.removeEventListener=c.detachEvent=function(){};return c}}(),enableGoogleLayersControl=function(){var l=function(i,h,e){if((i=i.getId())&&i.match(/^LAYER/))e.getLayerRoot().enableLayerById(e[i],h);else{var g=e.getOptions();switch(i){case "SUN":e.getSun().setVisibility(h);break;case "NAVIGATION_CONTROLS":i=e.VISIBILITY_SHOW;if(!h)i=e.VISIBILITY_HIDE;e.getNavigationControl().setVisibility(i);break;case "STATUS_BAR":g.setStatusBarVisibility(h);break;case "OVERVIEW_MAP":g.setOverviewMapVisibility(h);
break;case "SCALE_LEGEND":g.setScaleLegendVisibility(h);break;case "ATMOSPHERE":g.setAtmosphereVisibility(h);break;case "HISTORICAL_IMAGERY":e.getTime().setHistoricalImageryEnabled(h);break;case "GRID":g.setGridVisibility(h)}}};return function(i,h){if(!i||!h)alert("Must call enableGoogleLayersControl with both tree and ge options!");$(i).bind("toggleItem",function(e,g,b,c){l(c,b,h)});$(i).bind("kmlLoaded",function(e,g){for(var b=g.getFeatures().getChildNodes(),c=b.getLength(),j=0;j<c;j++){var o=b.item(j);
l(o,o.getVisibility(),h)}})}}();
